---
title: "Using `epidist` to estimate delay in reporting cases for the 2014-2016 Ebola outbreak in Sierra Leone"
description: "A more detailed guide to using the `epidist` R package"
output: 
  bookdown::html_document2:
    fig_caption: yes
    code_folding: show
    number_sections: true
pkgdown:
  as_is: true
# csl: https://raw.githubusercontent.com/citation-style-language/styles/master/apa-numeric-superscript-brackets.csl
link-citations: true
vignette: >
  %\VignetteIndexEntry{Getting in depth with epidist}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
# exclude compile warnings from cmdstanr
knitr::opts_chunk$set(
  fig.path = "figures/epidist-",
  cache = TRUE,
  collapse = TRUE,
  comment = "#>",
  message = FALSE,
  warning = FALSE,
  error = FALSE
)
```

```{r load-requirements}
library(epidist)
library(data.table)
library(purrr)
library(ggplot2)
```

# Data preparation

```{r}
data("sierra_leone_ebola_data")
```

Ebola data available in package.
From Fang et al. (2016).
<!-- @article{fang2016transmission, -->
<!--   title={Transmission dynamics of Ebola virus disease and intervention effectiveness in Sierra Leone}, -->
<!--   author={Fang, Li-Qun and Yang, Yang and Jiang, Jia-Fu and Yao, Hong-Wu and Kargbo, David and Li, Xin-Lou and Jiang, Bao-Gui and Kargbo, Brima and Tong, Yi-Gang and Wang, Ya-Wei and others}, -->
<!--   journal={Proceedings of the National Academy of Sciences}, -->
<!--   volume={113}, -->
<!--   number={16}, -->
<!--   pages={4488--4493}, -->
<!--   year={2016}, -->
<!--   publisher={National Acad Sciences} -->
<!-- } -->
Has `r nrow(sierra_leone_ebola_data)` rows, each corresponding to a unique case report.

```{r}
head(sierra_leone_ebola_data)
```

```{r}
# Might want to move to using data.table code rather than dplyr here/everywhere
sierra_leone_ebola_data |>
  dplyr::filter(id %% 10 == 0) |>
  ggplot() +
    geom_segment(
      aes(
        x = date_of_symptom_onset, xend = date_of_sample_tested,
        y = id, yend = id
      ),
      col = "grey"
    ) +
    geom_point(aes(x = date_of_symptom_onset, y = id), col = "#56B4E9") +
    geom_point(aes(x = date_of_sample_tested, y = id), col = "#009E73") +
    labs(x = "", y = "Case ID") +
    theme_minimal()
```

Clean it up using the paper code:
<!-- https://github.com/parksw3/epidist-paper/blob/d34a461c4d7526438d509eec99025abda30687c7/_targets.Rmd#L422 -->

```{r}
dt <- sierra_leone_ebola_data |>
  dplyr::mutate(
    date_of_symptom_onset = lubridate::ymd(date_of_symptom_onset),
    date_of_sample_tested = lubridate::ymd(date_of_sample_tested),
    ptime = as.numeric(date_of_symptom_onset - min(date_of_symptom_onset)),
    stime = as.numeric(date_of_sample_tested - min(date_of_symptom_onset))
  ) |>
  dplyr::select(id, ptime, stime) |>
  data.table::as.data.table()

head(dt)

dt <- epidist::observe_process(dt)

head(dt)
```

# Model fitting

* Fit the lognormal model
* Fit the gamma model
* Other things here? Convergence checking?

# Post-processing

* Extract posterior predictions (of something) from both models -- posterior predictive checking?
* Compare the models. Give suggestion of which is a better fit
* Translate fitted distribution to probability mass function

## Bibliography {-}