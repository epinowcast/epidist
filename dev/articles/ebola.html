<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using epidist to estimate delay between symptom onset and positive test for an Ebola outbreak in Sierra Leone • epidist</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="../favicon-48x48.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using epidist to estimate delay between symptom onset and positive test for an Ebola outbreak in Sierra Leone">
<meta name="description" content="A more detailed guide to using the epidist R package">
<meta property="og:description" content="A more detailed guide to using the epidist R package">
<meta property="og:image" content="https://epidist.epinowcast.org/logo.png">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">epidist</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.1.0.1000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/faq.html">FAQ</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/epidist.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/ebola.html">Advanced features with Ebola data</a></li>
    <li><a class="dropdown-item" href="../articles/approx-inference.html">Approximate Bayesian inference</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epinowcast/epidist/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Using epidist to estimate delay between symptom onset and positive test for an Ebola outbreak in Sierra Leone</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epinowcast/epidist/blob/main/vignettes/ebola.Rmd" class="external-link"><code>vignettes/ebola.Rmd</code></a></small>
      <div class="d-none name"><code>ebola.Rmd</code></div>
    </div>

    
    
<p>In this vignette, we use the <code>epidist</code> package to analyze line list data from the 2014-2016 outbreak of Ebola in Sierra Leone <span class="citation">(<a href="#ref-who_ebola_2014_2016">World Health Organization 2016</a>)</span>.
These data were collated by <span class="citation">Fang et al. (<a href="#ref-fang2016transmission">2016</a>)</span>.
We provide the data in the <code>epidist</code> package via <code><a href="../reference/sierra_leone_ebola_data.html">?sierra_leone_ebola_data</a></code>.
In analyzing this data, we demonstrate the following features of <code>epidist</code>:</p>
<ol style="list-style-type: decimal">
<li>Fitting district-sex stratified partially pooled delay distribution estimates with a lognormal delay distribution.</li>
<li>Post-processing and plotting functionality using the integration of <code>brms</code> functionality with the <a href="http://mjskay.github.io/tidybayes/" class="external-link"><code>tidybayes</code></a> package.</li>
</ol>
<p>The packages used in this article are:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://epidist.epinowcast.org/">epidist</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/tidybayes/" class="external-link">tidybayes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://modelr.tidyverse.org" class="external-link">modelr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/cmdstanr/" class="external-link">cmdstanr</a></span><span class="op">)</span> <span class="co"># nolint</span></span></code></pre></div>
<p>For users new to <code>epidist</code>, before reading this article we recommend beginning with the “<a href="http://epidist.epinowcast.org/articles/epidist.html" class="external-link">Getting started with <code>epidist</code></a>” vignette.</p>
<div class="section level2" number="1">
<h2 id="using-the-cmdstanr-backend">
<span class="header-section-number">1</span> Using the cmdstanr backend<a class="anchor" aria-label="anchor" href="#using-the-cmdstanr-backend"></a>
</h2>
<p>As the models explored in this vignette are relatively complex, we recommend using the <code>cmdstanr</code> backend for fitting models as it is typically more performant than the default <code>rstan</code> backend.
To use the <code>cmdstanr</code> backend, we first need to install CmdStan (see the README for more details).
We can check we have everything we need as follows:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cmdstanr</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/cmdstanr/reference/set_cmdstan_path.html" class="external-link">cmdstan_version</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2.36.0"</span></span></code></pre></div>
</div>
<div class="section level2" number="2">
<h2 id="data-preparation">
<span class="header-section-number">2</span> Data preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h2>
<p>We begin by loading the Ebola line list data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sierra_leone_ebola_data"</span><span class="op">)</span></span></code></pre></div>
<p>The data has 8358 rows, each corresponding to a unique case report <code>id</code>.
The columns of the data are the individuals name (retracted, and hence can be removed), age, sex, the dates of Ebola symptom onset and positive sample, and their district and chiefdom.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sierra_leone_ebola_data</span> <span class="op">&lt;-</span> <span class="va">sierra_leone_ebola_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">name</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    case <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>, .keep <span class="op">=</span> <span class="st">"unused"</span>,</span>
<span>    sex <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">sex</span> <span class="op">==</span> <span class="st">"F"</span> <span class="op">~</span> <span class="st">"Female"</span>,</span>
<span>      <span class="va">sex</span> <span class="op">==</span> <span class="st">"M"</span> <span class="op">~</span> <span class="st">"Male"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sierra_leone_ebola_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;     age sex    date_of_symptom_onset date_of_sample_tested district chiefdom   </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>    20 Female 2014-05-18 <span style="color: #949494;">00:00:00</span>   2014-05-23 <span style="color: #949494;">00:00:00</span>   Kailahun Kissi Teng </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>    42 Female 2014-05-20 <span style="color: #949494;">00:00:00</span>   2014-05-25 <span style="color: #949494;">00:00:00</span>   Kailahun Kissi Teng </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>    45 Female 2014-05-20 <span style="color: #949494;">00:00:00</span>   2014-05-25 <span style="color: #949494;">00:00:00</span>   Kailahun Kissi Tonge</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>    15 Female 2014-05-21 <span style="color: #949494;">00:00:00</span>   2014-05-26 <span style="color: #949494;">00:00:00</span>   Kailahun Kissi Teng </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>    19 Female 2014-05-21 <span style="color: #949494;">00:00:00</span>   2014-05-26 <span style="color: #949494;">00:00:00</span>   Kailahun Kissi Teng </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>    55 Female 2014-05-21 <span style="color: #949494;">00:00:00</span>   2014-05-26 <span style="color: #949494;">00:00:00</span>   Kailahun Kissi Teng </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: case &lt;int&gt;</span></span></span>
<span></span>
<span><span class="va">fraction</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">ndistrict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">sierra_leone_ebola_data</span><span class="op">$</span><span class="va">district</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Figure <a href="#fig:ebola-outbreak">2.1</a> shows the dates of symptom onset and sample testing for cases across in each district.
(In this figure, we filter down to every 5th case in order to avoid overplotting.)
We can see that the start time and course of the epidemic varies across districts.</p>

<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sierra_leone_ebola_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">case</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="va">fraction</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">date_of_symptom_onset</span>, xend <span class="op">=</span> <span class="va">date_of_sample_tested</span>,</span>
<span>      y <span class="op">=</span> <span class="va">case</span>, yend <span class="op">=</span> <span class="va">case</span></span>
<span>    <span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"grey"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_of_symptom_onset</span>, y <span class="op">=</span> <span class="va">case</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"#56B4E9"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_of_sample_tested</span>, y <span class="op">=</span> <span class="va">case</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"#009E73"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">district</span> <span class="op">~</span> <span class="va">.</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Case ID"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:ebola-outbreak"></span>
<img src="figures/epidist-ebola-outbreak-1.png" alt="Primary and secondary event times for every 5th case, over the 14 districts of Sierra Leone." width="672"><p class="caption">
Figure 2.1: Primary and secondary event times for every 5th case, over the 14 districts of Sierra Leone.
</p>
</div>
<p>We can use a map to help visualise the outbreak across space.
To create a map, we first join the Ebola data to shapefiles for the districts of Sierra Leone.
These shapefiles were obtained from the Database of Global Administrative Areas (<a href="https://gadm.org/" class="external-link">GADM</a>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>    <span class="st">"extdata"</span>, <span class="st">"gadm41_SLE_shp"</span>, <span class="st">"gadm41_SLE_2.shp"</span>,</span>
<span>    package <span class="op">=</span> <span class="st">"epidist"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sierra_leone_ebola_data_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">sf</span>, district <span class="op">=</span> <span class="va">NAME_2</span>, <span class="va">geometry</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    <span class="va">sierra_leone_ebola_data</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">district</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>cases <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Figure <a href="#fig:ebola-cloropleth">2.2</a> shows that the majority of cases were concentrated in the Western Urban district.
This district contains the capital of the country, and has the highest population (as such, one may also be interested in the prevalence of Ebola, that is the number of cases divided by the population size).</p>

<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sierra_leone_ebola_data_sf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">cases</span>, geometry <span class="op">=</span> <span class="va">geometry</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>na.value <span class="op">=</span> <span class="st">"lightgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Cases"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:ebola-cloropleth"></span>
<img src="figures/epidist-ebola-cloropleth-1.png" alt="A cloropleth showing the total number of Ebola cases in each district of Sierra Leone." width="672"><p class="caption">
Figure 2.2: A cloropleth showing the total number of Ebola cases in each district of Sierra Leone.
</p>
</div>
</div>
<div class="section level2" number="3">
<h2 id="fitting-sex-district-stratified-delay-distributions">
<span class="header-section-number">3</span> Fitting sex-district stratified delay distributions<a class="anchor" aria-label="anchor" href="#fitting-sex-district-stratified-delay-distributions"></a>
</h2>
<p>To understand the delay between time of symptom onset and time of sample testing, we fit a range of statistical models using the <code>epidist</code> package.
In some models, we vary the parameters of the delay distribution by sex or by district.
For the lognormal delay distribution these parameters are the mean and standard deviation of the underlying normal distribution.
That is, <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span> such that when <span class="math inline">\(x \sim \mathcal{N}(\mu, \sigma)\)</span> then <span class="math inline">\(\exp(x)\)</span> has a lognormal distribution.</p>
<div class="section level3" number="3.1">
<h3 id="data-preparation-1">
<span class="header-section-number">3.1</span> Data preparation<a class="anchor" aria-label="anchor" href="#data-preparation-1"></a>
</h3>
<p>To prepare the data, we begin by converting the date columns to <code>Date</code> objects and selecting the relevant columns:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_cens</span> <span class="op">&lt;-</span> <span class="va">sierra_leone_ebola_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># use lubridate::ymd() to drop any sub-date time info</span></span>
<span>    date_of_symptom_onset <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="va">date_of_symptom_onset</span><span class="op">)</span>,</span>
<span>    date_of_sample_tested <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="va">date_of_sample_tested</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">case</span>, <span class="va">date_of_symptom_onset</span>, <span class="va">date_of_sample_tested</span>, <span class="va">age</span>, <span class="va">sex</span>, <span class="va">district</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">obs_cens</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;    case date_of_symptom_onset date_of_sample_tested   age sex    district</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 2014-05-18            2014-05-23               20 Female Kailahun</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2 2014-05-20            2014-05-25               42 Female Kailahun</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3 2014-05-20            2014-05-25               45 Female Kailahun</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4 2014-05-21            2014-05-26               15 Female Kailahun</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     5 2014-05-21            2014-05-26               19 Female Kailahun</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     6 2014-05-21            2014-05-26               55 Female Kailahun</span></span></code></pre></div>
<p>For the time being, we filter the data to only complete cases (i.e. rows of the data which have no missing values<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;It should be a relatively simple extension to allow for missing data in the model.&lt;/p&gt;"><sup>1</sup></a>).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">obs_cens</span><span class="op">)</span></span>
<span><span class="va">obs_cens</span> <span class="op">&lt;-</span> <span class="va">obs_cens</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">obs_cens</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">n_complete</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">obs_cens</span><span class="op">)</span></span></code></pre></div>
<p>Here, 83% of the cases were complete.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subsample</span> <span class="op">&lt;-</span> <span class="fl">0.2</span></span></code></pre></div>
<p>Additionally, to speed up computation, we take a random 20% subsample of the complete data.
(In a real analysis, we’d recommend using all the available data.)</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_cens</span> <span class="op">&lt;-</span> <span class="va">obs_cens</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">n_complete</span> <span class="op">*</span> <span class="va">subsample</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we prepare the data for use with the <code>epidist</code> package by converting the data to an <code>epidist_linelist_data</code> object:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist_data</span> <span class="op">&lt;-</span> <span class="va">obs_cens</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_epidist_linelist_data.html">as_epidist_linelist_data</a></span><span class="op">(</span></span>
<span>    pdate_lwr <span class="op">=</span> <span class="st">"date_of_symptom_onset"</span>,</span>
<span>    sdate_lwr <span class="op">=</span> <span class="st">"date_of_sample_tested"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>In this call to <code><a href="../reference/as_epidist_linelist_data.html">as_epidist_linelist_data()</a></code> it has made some assumptions about the data.
First, because we did not supply upper bounds for the primary and secondary events (<code>pdate_upr</code> and <code>sdate_upr</code>), it has assumed that the upper bounds are one day after the lower bounds.
Second, because we also did not supply an observation time column (<code>obs_date</code>), it has assumed that the observation time is the maximum of the secondary event upper bounds.</p>
</div>
<div class="section level3" number="3.2">
<h3 id="model-fitting">
<span class="header-section-number">3.2</span> Model fitting<a class="anchor" aria-label="anchor" href="#model-fitting"></a>
</h3>
<p>To prepare the data for use with the marginal model, we define the data as being a <code>epidist_marginal_model</code> model object:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_prep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_epidist_marginal_model.html">as_epidist_marginal_model</a></span><span class="op">(</span><span class="va">linelist_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">obs_prep</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 21</span></span></span>
<span><span class="co">#&gt;   ptime_lwr ptime_upr stime_lwr stime_upr obs_time  case pdate_lwr  sdate_lwr </span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>       148       149       155       156      480  <span style="text-decoration: underline;">3</span>073 2014-10-13 2014-10-20</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>       149       150       155       156      480  <span style="text-decoration: underline;">3</span>125 2014-10-14 2014-10-20</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>       143       144       157       158      480  <span style="text-decoration: underline;">2</span>774 2014-10-08 2014-10-22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>        71        72        75        76      480   547 2014-07-28 2014-08-01</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>       186       187       191       192      480  <span style="text-decoration: underline;">5</span>394 2014-11-20 2014-11-25</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>       159       160       168       169      480  <span style="text-decoration: underline;">3</span>692 2014-10-24 2014-11-02</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 13 more variables: age &lt;dbl&gt;, sex &lt;chr&gt;, district &lt;chr&gt;, pdate_upr &lt;date&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   sdate_upr &lt;date&gt;, obs_date &lt;date&gt;, pwindow &lt;dbl&gt;, swindow &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   relative_obs_time &lt;dbl&gt;, orig_relative_obs_time &lt;dbl&gt;, delay_lwr &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   delay_upr &lt;dbl&gt;, n &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Now we are ready to fit the marginal model.</p>
<div class="section level4" number="3.2.1">
<h4 id="intercept-only-model">
<span class="header-section-number">3.2.1</span> Intercept-only model<a class="anchor" aria-label="anchor" href="#intercept-only-model"></a>
</h4>
<p>We start by fitting a single lognormal distribution to the data.
This model assumes that a single distribution describes all delays in the data, regardless of the case’s location, sex, or any other covariates.
To do this, we set <code>formula = mu ~ 1</code> to place an model with only an intercept parameter (i.e. <code>~ 1</code> in R formula syntax) on the <code>mu</code> parameter of the lognormal distribution specified using <code>family = lognormal()</code>.
(Note that the lognormal distribution has two distributional parameters <code>mu</code> and <code>sigma</code>.
As a model is not explicitly placed on <code>sigma</code>, a constant model <code>sigma ~ 1</code> is assumed.)</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/epidist.html">epidist</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">obs_prep</span>,</span>
<span>  formula <span class="op">=</span> <span class="va">mu</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://paulbuerkner.com/brms/reference/brmsfamily.html" class="external-link">lognormal</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  algorithm <span class="op">=</span> <span class="st">"sampling"</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  cores <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  refresh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">250</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  backend <span class="op">=</span> <span class="st">"cmdstanr"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Running MCMC with 2 parallel chains...</span></span>
<span><span class="co">#&gt; Chain 1 finished in 0.8 seconds.</span></span>
<span><span class="co">#&gt; Chain 2 finished in 0.8 seconds.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Both chains finished successfully.</span></span>
<span><span class="co">#&gt; Mean chain execution time: 0.8 seconds.</span></span>
<span><span class="co">#&gt; Total execution time: 0.9 seconds.</span></span></code></pre></div>
<p>The <code>fit</code> object is a <a href="https://paulbuerkner.com/brms/reference/brmsfit-class.html" class="external-link"><code>brmsfit</code></a> object, and has the associated range of methods.
See <code>methods(class = "brmsfit")</code> for more details.
For example, we may use <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> to view information about the fitted model, including posterior estimates for the regression coefficients:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Family: marginal_lognormal </span></span>
<span><span class="co">#&gt;   Links: mu = identity; sigma = log </span></span>
<span><span class="co">#&gt; Formula: delay_lwr | weights(n) + vreal(relative_obs_time, pwindow, swindow, delay_upr) ~ 1 </span></span>
<span><span class="co">#&gt;          sigma ~ 1</span></span>
<span><span class="co">#&gt;    Data: transformed_data (Number of observations: 50) </span></span>
<span><span class="co">#&gt;   Draws: 2 chains, each with iter = 2000; warmup = 1000; thin = 1;</span></span>
<span><span class="co">#&gt;          total post-warmup draws = 2000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Regression Coefficients:</span></span>
<span><span class="co">#&gt;                 Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; Intercept           1.61      0.02     1.58     1.64 1.00     1589     1294</span></span>
<span><span class="co">#&gt; sigma_Intercept    -0.53      0.02    -0.57    -0.49 1.00     1208     1219</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span></span>
<span><span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code></pre></div>
</div>
<div class="section level4" number="3.2.2">
<h4 id="sex-stratified-model">
<span class="header-section-number">3.2.2</span> Sex-stratified model<a class="anchor" aria-label="anchor" href="#sex-stratified-model"></a>
</h4>
<p>To fit a model which varies the parameters of the fitted lognormal distribution, <code>mu</code> and <code>sigma</code>, by sex we alter the <code>formula</code> specification to include fixed effects for sex <code>~ 1 + sex</code> as follows:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/epidist.html">epidist</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">obs_prep</span>,</span>
<span>  formula <span class="op">=</span> <span class="fu"><a href="https://paulbuerkner.com/brms/reference/brmsformula.html" class="external-link">bf</a></span><span class="op">(</span><span class="va">mu</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">sex</span>, <span class="va">sigma</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">sex</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://paulbuerkner.com/brms/reference/brmsfamily.html" class="external-link">lognormal</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  algorithm <span class="op">=</span> <span class="st">"sampling"</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  cores <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  refresh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">250</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  backend <span class="op">=</span> <span class="st">"cmdstanr"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Running MCMC with 2 parallel chains...</span></span>
<span><span class="co">#&gt; Chain 1 finished in 1.5 seconds.</span></span>
<span><span class="co">#&gt; Chain 2 finished in 1.4 seconds.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Both chains finished successfully.</span></span>
<span><span class="co">#&gt; Mean chain execution time: 1.4 seconds.</span></span>
<span><span class="co">#&gt; Total execution time: 1.5 seconds.</span></span></code></pre></div>
<p>A summary of the model shows that males tend to have longer delays (the posterior mean of <code>sexMale</code> is 0.06) and greater delay variation (the posterior mean of <code>sigma_sexMale</code> is -0.01).
For the <code>sexMale</code> effect, the 95% credible interval is greater than zero, whereas for the <code>sigma_sexMale</code> effect the 95% credible interval includes zero.
It is important to note that the estimates represent an average of the observed data, and individual delays between men and women vary significantly.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_sex</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Family: marginal_lognormal </span></span>
<span><span class="co">#&gt;   Links: mu = identity; sigma = log </span></span>
<span><span class="co">#&gt; Formula: delay_lwr | weights(n) + vreal(relative_obs_time, pwindow, swindow, delay_upr) ~ sex </span></span>
<span><span class="co">#&gt;          sigma ~ 1 + sex</span></span>
<span><span class="co">#&gt;    Data: transformed_data (Number of observations: 72) </span></span>
<span><span class="co">#&gt;   Draws: 2 chains, each with iter = 2000; warmup = 1000; thin = 1;</span></span>
<span><span class="co">#&gt;          total post-warmup draws = 2000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Regression Coefficients:</span></span>
<span><span class="co">#&gt;                 Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; Intercept           1.58      0.02     1.54     1.63 1.00     2051     1409</span></span>
<span><span class="co">#&gt; sigma_Intercept    -0.53      0.03    -0.58    -0.47 1.00     2093     1641</span></span>
<span><span class="co">#&gt; sexMale             0.06      0.03    -0.01     0.12 1.00     2147     1579</span></span>
<span><span class="co">#&gt; sigma_sexMale      -0.01      0.04    -0.09     0.08 1.00     2177     1387</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span></span>
<span><span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code></pre></div>
</div>
<div class="section level4" number="3.2.3">
<h4 id="sex-district-stratified-model">
<span class="header-section-number">3.2.3</span> Sex-district stratified model<a class="anchor" aria-label="anchor" href="#sex-district-stratified-model"></a>
</h4>
<p>Finally, we will fit a model which also varies by district.
To do this, we will use district level random effects, assumed to be drawn from a shared normal distribution, within the model for both the <code>mu</code> and <code>sigma</code> parameters.
These random effects are specified by including <code>(1 | district)</code> in the formulas:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_sex_district</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/epidist.html">epidist</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">obs_prep</span>,</span>
<span>  formula <span class="op">=</span> <span class="fu"><a href="https://paulbuerkner.com/brms/reference/brmsformula.html" class="external-link">bf</a></span><span class="op">(</span></span>
<span>    <span class="va">mu</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">district</span><span class="op">)</span>,</span>
<span>    <span class="va">sigma</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">district</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://paulbuerkner.com/brms/reference/brmsfamily.html" class="external-link">lognormal</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  algorithm <span class="op">=</span> <span class="st">"sampling"</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  cores <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  refresh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">250</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  backend <span class="op">=</span> <span class="st">"cmdstanr"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Running MCMC with 2 parallel chains...</span></span>
<span><span class="co">#&gt; Chain 1 finished in 29.6 seconds.</span></span>
<span><span class="co">#&gt; Chain 2 finished in 29.7 seconds.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Both chains finished successfully.</span></span>
<span><span class="co">#&gt; Mean chain execution time: 29.6 seconds.</span></span>
<span><span class="co">#&gt; Total execution time: 29.9 seconds.</span></span></code></pre></div>
<p>For this model, along with looking at the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>, we may also use the <code><a href="https://rdrr.io/pkg/nlme/man/random.effects.html" class="external-link">brms::ranef()</a></code> function to look at the estimates of the random effects:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_sex_district</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Family: marginal_lognormal </span></span>
<span><span class="co">#&gt;   Links: mu = identity; sigma = log </span></span>
<span><span class="co">#&gt; Formula: delay_lwr | weights(n) + vreal(relative_obs_time, pwindow, swindow, delay_upr) ~ sex + (1 | district) </span></span>
<span><span class="co">#&gt;          sigma ~ 1 + sex + (1 | district)</span></span>
<span><span class="co">#&gt;    Data: transformed_data (Number of observations: 307) </span></span>
<span><span class="co">#&gt;   Draws: 2 chains, each with iter = 2000; warmup = 1000; thin = 1;</span></span>
<span><span class="co">#&gt;          total post-warmup draws = 2000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multilevel Hyperparameters:</span></span>
<span><span class="co">#&gt; ~district (Number of levels: 14) </span></span>
<span><span class="co">#&gt;                     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; sd(Intercept)           0.12      0.04     0.07     0.22 1.00      498      847</span></span>
<span><span class="co">#&gt; sd(sigma_Intercept)     0.23      0.07     0.13     0.40 1.01      571      902</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Regression Coefficients:</span></span>
<span><span class="co">#&gt;                 Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; Intercept           1.61      0.04     1.52     1.70 1.00      738      602</span></span>
<span><span class="co">#&gt; sigma_Intercept    -0.61      0.08    -0.76    -0.46 1.00      520      744</span></span>
<span><span class="co">#&gt; sexMale             0.05      0.03    -0.00     0.11 1.00     2492     1524</span></span>
<span><span class="co">#&gt; sigma_sexMale       0.01      0.04    -0.07     0.09 1.00     1757     1514</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span></span>
<span><span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/random.effects.html" class="external-link">ranef</a></span><span class="op">(</span><span class="va">fit_sex_district</span><span class="op">)</span></span>
<span><span class="co">#&gt; $district</span></span>
<span><span class="co">#&gt; , , Intercept</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                    Estimate  Est.Error        Q2.5       Q97.5</span></span>
<span><span class="co">#&gt; Bo             0.0509547414 0.07455982 -0.08904569  0.19827340</span></span>
<span><span class="co">#&gt; Bombali        0.1738670529 0.04902862  0.08310500  0.27218873</span></span>
<span><span class="co">#&gt; Bonthe         0.0066828621 0.12386015 -0.23989315  0.24889700</span></span>
<span><span class="co">#&gt; Kailahun      -0.0349193841 0.05853575 -0.14873947  0.08578665</span></span>
<span><span class="co">#&gt; Kambia         0.0188801723 0.08637311 -0.15018225  0.19520920</span></span>
<span><span class="co">#&gt; Kenema        -0.1227126689 0.07021254 -0.25806205  0.01227062</span></span>
<span><span class="co">#&gt; Koinadugu      0.1302810457 0.10320871 -0.06004090  0.35129225</span></span>
<span><span class="co">#&gt; Kono          -0.0455211272 0.07770321 -0.20929227  0.10534732</span></span>
<span><span class="co">#&gt; Moyamba        0.0215471192 0.08505060 -0.14249708  0.18777437</span></span>
<span><span class="co">#&gt; Port Loko     -0.0006319715 0.05433233 -0.10991450  0.11026570</span></span>
<span><span class="co">#&gt; Pujehun       -0.0359921387 0.11176176 -0.26237150  0.18250285</span></span>
<span><span class="co">#&gt; Tonkolili      0.0479354848 0.05760393 -0.06552056  0.16424480</span></span>
<span><span class="co">#&gt; Western Rural -0.0167154876 0.05607610 -0.12874527  0.09480375</span></span>
<span><span class="co">#&gt; Western Urban -0.1715535152 0.05240212 -0.28034640 -0.07289722</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , sigma_Intercept</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                  Estimate  Est.Error         Q2.5       Q97.5</span></span>
<span><span class="co">#&gt; Bo            -0.07145974 0.11927484 -0.314371625  0.16015302</span></span>
<span><span class="co">#&gt; Bombali       -0.27260373 0.08824452 -0.453975275 -0.10664748</span></span>
<span><span class="co">#&gt; Bonthe        -0.04643115 0.23406814 -0.531202825  0.39493142</span></span>
<span><span class="co">#&gt; Kailahun      -0.20432171 0.09877458 -0.409255050 -0.01888796</span></span>
<span><span class="co">#&gt; Kambia         0.25607138 0.11958155  0.031685158  0.50440700</span></span>
<span><span class="co">#&gt; Kenema         0.19538970 0.10371349  0.003014475  0.40670090</span></span>
<span><span class="co">#&gt; Koinadugu      0.01499080 0.15275327 -0.279609950  0.31441425</span></span>
<span><span class="co">#&gt; Kono           0.10477126 0.11312463 -0.112742900  0.32890932</span></span>
<span><span class="co">#&gt; Moyamba        0.14597517 0.12060459 -0.075481687  0.39176985</span></span>
<span><span class="co">#&gt; Port Loko      0.08893739 0.08568804 -0.069918905  0.26011608</span></span>
<span><span class="co">#&gt; Pujehun       -0.14082757 0.22912447 -0.631964950  0.26410067</span></span>
<span><span class="co">#&gt; Tonkolili     -0.23458641 0.10494872 -0.450323850 -0.02735900</span></span>
<span><span class="co">#&gt; Western Rural  0.02978665 0.08656601 -0.136886275  0.20073985</span></span>
<span><span class="co">#&gt; Western Urban  0.19312716 0.08323092  0.035890197  0.36003598</span></span></code></pre></div>
</div>
</div>
<div class="section level3" number="3.3">
<h3 id="posterior-expectation">
<span class="header-section-number">3.3</span> Posterior expectations<a class="anchor" aria-label="anchor" href="#posterior-expectation"></a>
</h3>
<p>To go further than summaries of the fitted model, we recommend using the <code>tidybayes</code> package.
For example, to obtain the posterior expectation of the delay distribution, under no censoring or truncation, we may use the <code><a href="https://modelr.tidyverse.org/reference/data_grid.html" class="external-link">modelr::data_grid()</a></code> function in combination with the <code><a href="https://mjskay.github.io/tidybayes/reference/add_predicted_draws.html" class="external-link">tidybayes::add_epred_draws()</a></code> function.
The <code><a href="https://mjskay.github.io/tidybayes/reference/add_predicted_draws.html" class="external-link">tidybayes::add_epred_draws()</a></code> function uses the <code><a href="../reference/epidist_gen_posterior_predict.html">epidist_gen_posterior_predict()</a></code> function to generate a posterior prediction function for the <code><a href="https://paulbuerkner.com/brms/reference/brmsfamily.html" class="external-link">lognormal()</a></code> distribution.</p>
<p>In Figure <a href="#fig:epred">3.1</a> we show the posterior expectation of the delay distribution for each of the three fitted models.
Figure <a href="#fig:epred">3.1</a>B illustrates the higher mean of men as compared with women.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add dummmy variables</span></span>
<span><span class="va">add_marginal_dummy_vars</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>relative_obs_time <span class="op">=</span> <span class="cn">NA</span>, pwindow <span class="op">=</span> <span class="cn">NA</span>, delay_upr <span class="op">=</span> <span class="cn">NA</span>, swindow <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">epred_draws</span> <span class="op">&lt;-</span> <span class="va">obs_prep</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://modelr.tidyverse.org/reference/data_grid.html" class="external-link">data_grid</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_marginal_dummy_vars</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://mjskay.github.io/tidybayes/reference/add_predicted_draws.html" class="external-link">add_epred_draws</a></span><span class="op">(</span><span class="va">fit</span>, dpar <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">epred_base_figure</span> <span class="op">&lt;-</span> <span class="va">epred_draws</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.epred</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_halfeye.html" class="external-link">stat_halfeye</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span>, title <span class="op">=</span> <span class="st">"Intercept-only"</span>, tag <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">epred_draws_sex</span> <span class="op">&lt;-</span> <span class="va">obs_prep</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://modelr.tidyverse.org/reference/data_grid.html" class="external-link">data_grid</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_marginal_dummy_vars</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://mjskay.github.io/tidybayes/reference/add_predicted_draws.html" class="external-link">add_epred_draws</a></span><span class="op">(</span><span class="va">fit_sex</span>, dpar <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">epred_sex_figure</span> <span class="op">&lt;-</span> <span class="va">epred_draws_sex</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.epred</span>, y <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_halfeye.html" class="external-link">stat_halfeye</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span>, title <span class="op">=</span> <span class="st">"Sex-stratified"</span>, tag <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">epred_draws_sex_district</span> <span class="op">&lt;-</span> <span class="va">obs_prep</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://modelr.tidyverse.org/reference/data_grid.html" class="external-link">data_grid</a></span><span class="op">(</span><span class="va">sex</span>, <span class="va">district</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_marginal_dummy_vars</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://mjskay.github.io/tidybayes/reference/add_predicted_draws.html" class="external-link">add_epred_draws</a></span><span class="op">(</span><span class="va">fit_sex_district</span>, dpar <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">epred_sex_district_figure</span> <span class="op">&lt;-</span> <span class="va">epred_draws_sex_district</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.epred</span>, y <span class="op">=</span> <span class="va">district</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_pointinterval.html" class="external-link">stat_pointinterval</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">sex</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Posterior expectation of the delay"</span>, y <span class="op">=</span> <span class="st">""</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Sex-district-stratified"</span>, tag <span class="op">=</span> <span class="st">"C"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_y_discrete</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="va">rev</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>

<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">epred_base_figure</span> <span class="op">/</span> <span class="va">epred_sex_figure</span> <span class="op">/</span> <span class="va">epred_sex_district_figure</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:epred"></span>
<img src="figures/epidist-epred-1.png" alt="The fitted posterior expectations of the delay distribution for each model." width="672"><p class="caption">
Figure 3.1: The fitted posterior expectations of the delay distribution for each model.
</p>
</div>
</div>
<div class="section level3" number="3.4">
<h3 id="linear-predictor-posteriors">
<span class="header-section-number">3.4</span> Linear predictor posteriors<a class="anchor" aria-label="anchor" href="#linear-predictor-posteriors"></a>
</h3>
<p>The <code>tidybayes</code> package also allows users to generate draws of the linear predictors for all distributional parameters using <code><a href="https://mjskay.github.io/tidybayes/reference/add_predicted_draws.html" class="external-link">tidybayes::add_linpred_draws()</a></code>.
For example, for the <code>mu</code> parameter in the sex-district stratified model (Figure <a href="#fig:linpred-sex-district">3.2</a>):</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linpred_draws_sex_district</span> <span class="op">&lt;-</span> <span class="va">obs_prep</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://modelr.tidyverse.org/reference/data_grid.html" class="external-link">data_grid</a></span><span class="op">(</span><span class="va">sex</span>, <span class="va">district</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_marginal_dummy_vars</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://mjskay.github.io/tidybayes/reference/add_predicted_draws.html" class="external-link">add_linpred_draws</a></span><span class="op">(</span><span class="va">fit_sex_district</span>, dpar <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>

<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linpred_draws_sex_district</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mu</span>, y <span class="op">=</span> <span class="va">district</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_pointinterval.html" class="external-link">stat_pointinterval</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">sex</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Posterior of the mu linear predictor"</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_y_discrete</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="va">rev</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:linpred-sex-district"></span>
<img src="figures/epidist-linpred-sex-district-1.png" alt="The posterior distribution of the linear predictor of mu parameter within the sex-district stratified model. The posterior expectations in Section 3.3 are a function of both the mu linear predictor posterior distribution and sigma linear predictor posterior distribution." width="672"><p class="caption">
Figure 3.2: The posterior distribution of the linear predictor of <code>mu</code> parameter within the sex-district stratified model. The posterior expectations in Section <a href="#posterior-expectation">3.3</a> are a function of both the <code>mu</code> linear predictor posterior distribution and <code>sigma</code> linear predictor posterior distribution.
</p>
</div>
</div>
<div class="section level3" number="3.5">
<h3 id="delay-posterior-distributions">
<span class="header-section-number">3.5</span> Delay posterior distributions<a class="anchor" aria-label="anchor" href="#delay-posterior-distributions"></a>
</h3>
<p>Posterior predictions of the delay distribution are an important output of an analysis with the <code>epidist</code> package.
In this section, we demonstrate how to produce either a discrete probability mass function representation, or continuous probability density function representation of the delay distribution.</p>
<div class="section level4" number="3.5.1">
<h4 id="discrete-probability-mass-function">
<span class="header-section-number">3.5.1</span> Discrete probability mass function<a class="anchor" aria-label="anchor" href="#discrete-probability-mass-function"></a>
</h4>
<p>To generate a discrete probability mass function (PMF) we predict the delay distribution that would be observed with daily censoring and no right truncation.
To do this, we set each of <code>pwindow</code> and <code>swindow</code> to 1 for daily censoring, and <code>relative_obs_time</code> to <code>Inf</code> for no right truncation.
Figure <a href="#fig:pmf">3.3</a> shows the result, where the few delays greater than 30 are omitted from the figure.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">add_marginal_pmf_vars</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      relative_obs_time <span class="op">=</span> <span class="cn">Inf</span>, pwindow <span class="op">=</span> <span class="fl">1</span>, swindow <span class="op">=</span> <span class="fl">1</span>, delay_upr <span class="op">=</span> <span class="cn">NA</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">draws_pmf</span> <span class="op">&lt;-</span> <span class="va">obs_prep</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_marginal_pmf_vars</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://mjskay.github.io/tidybayes/reference/add_predicted_draws.html" class="external-link">add_predicted_draws</a></span><span class="op">(</span><span class="va">fit</span>, ndraws <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pmf_base_figure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">draws_pmf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.prediction</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">count</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span>, title <span class="op">=</span> <span class="st">"Intercept-only"</span>, tag <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">draws_sex_pmf</span> <span class="op">&lt;-</span> <span class="va">obs_prep</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://modelr.tidyverse.org/reference/data_grid.html" class="external-link">data_grid</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_marginal_pmf_vars</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://mjskay.github.io/tidybayes/reference/add_predicted_draws.html" class="external-link">add_predicted_draws</a></span><span class="op">(</span><span class="va">fit_sex</span>, ndraws <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pmf_sex_figure</span> <span class="op">&lt;-</span> <span class="va">draws_sex_pmf</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.prediction</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">count</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html" class="external-link">ave</a></span><span class="op">(</span><span class="va">count</span>, <span class="va">PANEL</span>, FUN <span class="op">=</span> <span class="va">sum</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span>, title <span class="op">=</span> <span class="st">"Sex-stratified"</span>, tag <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">sex</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">draws_sex_district_pmf</span> <span class="op">&lt;-</span> <span class="va">obs_prep</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://modelr.tidyverse.org/reference/data_grid.html" class="external-link">data_grid</a></span><span class="op">(</span><span class="va">sex</span>, <span class="va">district</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_marginal_pmf_vars</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://mjskay.github.io/tidybayes/reference/add_predicted_draws.html" class="external-link">add_predicted_draws</a></span><span class="op">(</span><span class="va">fit_sex_district</span>, ndraws <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pmf_sex_district_figure</span> <span class="op">&lt;-</span> <span class="va">draws_sex_district_pmf</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    district <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">district</span> <span class="op">==</span> <span class="st">"Port Loko"</span> <span class="op">~</span> <span class="st">"Port\nLoko"</span>,</span>
<span>      <span class="va">district</span> <span class="op">==</span> <span class="st">"Western Rural"</span> <span class="op">~</span> <span class="st">"Western\nRural"</span>,</span>
<span>      <span class="va">district</span> <span class="op">==</span> <span class="st">"Western Urban"</span> <span class="op">~</span> <span class="st">"Western\nUrban"</span>,</span>
<span>      .default <span class="op">=</span> <span class="va">district</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.prediction</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">count</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html" class="external-link">ave</a></span><span class="op">(</span><span class="va">count</span>, <span class="va">PANEL</span>, FUN <span class="op">=</span> <span class="va">sum</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"PMF with daily censoring and no truncation"</span>, y <span class="op">=</span> <span class="st">""</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Sex-district-stratified"</span>, tag <span class="op">=</span> <span class="st">"C"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">district</span> <span class="op">~</span> <span class="va">sex</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>

<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pmf_base_figure</span> <span class="op">/</span> <span class="va">pmf_sex_figure</span> <span class="op">/</span> <span class="va">pmf_sex_district_figure</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">5.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:pmf"></span>
<img src="figures/epidist-pmf-1.png" alt="Posterior predictions of the discrete probability mass function for each of the fitted models." width="672"><p class="caption">
Figure 3.3: Posterior predictions of the discrete probability mass function for each of the fitted models.
</p>
</div>
</div>
<div class="section level4" number="3.5.2">
<h4 id="continuous-probability-density-function">
<span class="header-section-number">3.5.2</span> Continuous probability density function<a class="anchor" aria-label="anchor" href="#continuous-probability-density-function"></a>
</h4>
<p>The posterior predictive distribution under no truncation and no censoring.
That is to produce continuous delay times (Figure <a href="#fig:pdf">3.4</a>):</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">add_marginal_pdf_vars</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      relative_obs_time <span class="op">=</span> <span class="cn">Inf</span>, pwindow <span class="op">=</span> <span class="fl">0</span>, swindow <span class="op">=</span> <span class="fl">0</span>, delay_upr <span class="op">=</span> <span class="cn">NA</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">draws_pdf</span> <span class="op">&lt;-</span> <span class="va">obs_prep</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_marginal_pdf_vars</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://mjskay.github.io/tidybayes/reference/add_predicted_draws.html" class="external-link">add_predicted_draws</a></span><span class="op">(</span><span class="va">fit</span>, ndraws <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pdf_base_figure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">draws_pdf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.prediction</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span>, title <span class="op">=</span> <span class="st">"Intercept-only"</span>, tag <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">draws_sex_pdf</span> <span class="op">&lt;-</span> <span class="va">obs_prep</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://modelr.tidyverse.org/reference/data_grid.html" class="external-link">data_grid</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_marginal_pdf_vars</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://mjskay.github.io/tidybayes/reference/add_predicted_draws.html" class="external-link">add_predicted_draws</a></span><span class="op">(</span><span class="va">fit_sex</span>, ndraws <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pdf_sex_figure</span> <span class="op">&lt;-</span> <span class="va">draws_sex_pdf</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.prediction</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span>, title <span class="op">=</span> <span class="st">"Sex-stratified"</span>, tag <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">sex</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">draws_sex_district_pdf</span> <span class="op">&lt;-</span> <span class="va">obs_prep</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://modelr.tidyverse.org/reference/data_grid.html" class="external-link">data_grid</a></span><span class="op">(</span><span class="va">sex</span>, <span class="va">district</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_marginal_pdf_vars</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://mjskay.github.io/tidybayes/reference/add_predicted_draws.html" class="external-link">add_predicted_draws</a></span><span class="op">(</span><span class="va">fit_sex_district</span>, ndraws <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pdf_sex_district_figure</span> <span class="op">&lt;-</span> <span class="va">draws_sex_district_pdf</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    district <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">district</span> <span class="op">==</span> <span class="st">"Port Loko"</span> <span class="op">~</span> <span class="st">"Port\nLoko"</span>,</span>
<span>      <span class="va">district</span> <span class="op">==</span> <span class="st">"Western Rural"</span> <span class="op">~</span> <span class="st">"Western\nRural"</span>,</span>
<span>      <span class="va">district</span> <span class="op">==</span> <span class="st">"Western Urban"</span> <span class="op">~</span> <span class="st">"Western\nUrban"</span>,</span>
<span>      .default <span class="op">=</span> <span class="va">district</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.prediction</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"PDF with no censoring and no truncation"</span>, y <span class="op">=</span> <span class="st">""</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Sex-district-stratified"</span>, tag <span class="op">=</span> <span class="st">"C"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">district</span> <span class="op">~</span> <span class="va">sex</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>

<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pdf_base_figure</span> <span class="op">/</span> <span class="va">pdf_sex_figure</span> <span class="op">/</span> <span class="va">pdf_sex_district_figure</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">5.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:pdf"></span>
<img src="figures/epidist-pdf-1.png" alt="Posterior predictions of the continuous probability density function for each of the fitted models." width="672"><p class="caption">
Figure 3.4: Posterior predictions of the continuous probability density function for each of the fitted models.
</p>
</div>
</div>
</div>
</div>
<div class="section level2" number="4">
<h2 id="conclusion">
<span class="header-section-number">4</span> Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>In this vignette, we demonstrate how the <code>epidist</code> package can be used to fit delay distribution models.
These models can be stratified by covariates such as sex and district using fixed and random effects.
Post-processing and prediction with fitted models is possible using the <code>tidybayes</code> package.
We illustrate generating posterior expectations, the posteriors of linear predictors, as well as discrete and continuous representations of the delay distribution.</p>
<div class="section level3">
<h3 id="bibliography">Bibliography<a class="anchor" aria-label="anchor" href="#bibliography"></a>
</h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-fang2016transmission" class="csl-entry">
Fang, Li-Qun, Yang Yang, Jia-Fu Jiang, Hong-Wu Yao, David Kargbo, Xin-Lou Li, Bao-Gui Jiang, et al. 2016. <span>“Transmission Dynamics of Ebola Virus Disease and Intervention Effectiveness in Sierra Leone.”</span> <em>Proceedings of the National Academy of Sciences</em> 113 (16): 4488–93.
</div>
<div id="ref-who_ebola_2014_2016" class="csl-entry">
World Health Organization. 2016. <span>“Ebola Outbreak 2014-2016 - West Africa.”</span> <a href="https://www.who.int/emergencies/situations/ebola-outbreak-2014-2016-West-Africa" class="external-link">https://www.who.int/emergencies/situations/ebola-outbreak-2014-2016-West-Africa</a>.
</div>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://athowes.github.io/" class="external-link">Adam Howes</a>, Sang Woo Park, <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
