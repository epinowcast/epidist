<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Frequently asked questions and tips • epidist</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="../favicon-48x48.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Frequently asked questions and tips">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">epidist</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.2.0.1000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/faq.html">FAQ</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/epidist.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/ebola.html">Advanced features with Ebola data</a></li>
    <li><a class="dropdown-item" href="../articles/approx-inference.html">Approximate Bayesian inference</a></li>
    <li><a class="dropdown-item" href="../articles/model.html">Guide to the statistical models implemented in epidist</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epinowcast/epidist/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Frequently asked questions and tips</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epinowcast/epidist/blob/main/vignettes/faq.Rmd" class="external-link"><code>vignettes/faq.Rmd</code></a></small>
      <div class="d-none name"><code>faq.Rmd</code></div>
    </div>

    
    
<p>Here we provide tips for working with the <code>epidist</code> package, and answers to frequently asked questions.
If you have a question about using the package, please create an <a href="https://github.com/epinowcast/epidist/issues" class="external-link">issue</a>.
We will endeavour to respond promptly!</p>
<p>The code block below facilitates reproduction of this script.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://epidist.epinowcast.org/">epidist</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/tidybayes/" class="external-link">tidybayes</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">meanlog</span> <span class="op">&lt;-</span> <span class="fl">1.8</span></span>
<span><span class="va">sdlog</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">obs_time</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span><span class="va">sample_size</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span></span>
<span><span class="va">obs_cens_trunc_samp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_gillespie.html">simulate_gillespie</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="fl">101</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/simulate_secondary.html">simulate_secondary</a></span><span class="op">(</span></span>
<span>    meanlog <span class="op">=</span> <span class="va">meanlog</span>,</span>
<span>    sdlog <span class="op">=</span> <span class="va">sdlog</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    ptime_lwr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">ptime</span><span class="op">)</span>,</span>
<span>    ptime_upr <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">ptime_lwr</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>    stime_lwr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">stime</span><span class="op">)</span>,</span>
<span>    stime_upr <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">stime_lwr</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>    obs_time <span class="op">=</span> <span class="va">obs_time</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">stime_upr</span> <span class="op">&lt;=</span> <span class="va">.data</span><span class="op">$</span><span class="va">obs_time</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">sample_size</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">linelist_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_epidist_linelist_data.html">as_epidist_linelist_data</a></span><span class="op">(</span></span>
<span>  <span class="va">obs_cens_trunc_samp</span><span class="op">$</span><span class="va">ptime_lwr</span>,</span>
<span>  <span class="va">obs_cens_trunc_samp</span><span class="op">$</span><span class="va">ptime_upr</span>,</span>
<span>  <span class="va">obs_cens_trunc_samp</span><span class="op">$</span><span class="va">stime_lwr</span>,</span>
<span>  <span class="va">obs_cens_trunc_samp</span><span class="op">$</span><span class="va">stime_upr</span>,</span>
<span>  obs_time <span class="op">=</span> <span class="va">obs_cens_trunc_samp</span><span class="op">$</span><span class="va">obs_time</span></span>
<span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_epidist_marginal_model.html">as_epidist_marginal_model</a></span><span class="op">(</span><span class="va">linelist_data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/epidist.html">epidist</a></span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  formula <span class="op">=</span> <span class="va">mu</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  cores <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  refresh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">250</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  backend <span class="op">=</span> <span class="st">"cmdstanr"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="i-would-like-to-work-with-the-samples-output">I would like to work with the samples output<a class="anchor" aria-label="anchor" href="#i-would-like-to-work-with-the-samples-output"></a>
</h3>
<p>The output of a call to <code>epidist</code> is compatible with typical Stan workflows.
We recommend use of the <a href="https://mc-stan.org/posterior/" class="external-link"><code>posterior</code></a> package for working with samples from MCMC or other sampling algorithms.
For example, the function <code><a href="https://mc-stan.org/posterior/reference/draws_df.html" class="external-link">posterior::as_draws_df()</a></code> may be used to obtain a dataframe of MCMC draws for specified parameters.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/posterior/" class="external-link">posterior</a></span><span class="op">)</span></span>
<span><span class="va">draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_df.html" class="external-link">as_draws_df</a></span><span class="op">(</span><span class="va">fit</span>, variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Intercept"</span>, <span class="st">"Intercept_sigma"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## # A draws_df: 6 iterations, 1 chains, and 2 variables</span></span>
<span><span class="co">##   Intercept Intercept_sigma</span></span>
<span><span class="co">## 1       1.7           -0.78</span></span>
<span><span class="co">## 2       1.7           -0.84</span></span>
<span><span class="co">## 3       1.7           -0.80</span></span>
<span><span class="co">## 4       1.7           -0.78</span></span>
<span><span class="co">## 5       1.8           -0.79</span></span>
<span><span class="co">## 6       1.8           -0.77</span></span>
<span><span class="co">## # ... hidden reserved variables {'.chain', '.iteration', '.draw'}</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="how-can-i-assess-whether-sampling-has-converged">How can I assess whether sampling has converged?<a class="anchor" aria-label="anchor" href="#how-can-i-assess-whether-sampling-has-converged"></a>
</h3>
<p>The output of a call to <code>epidist</code> is compatible with typical Stan workflows.
We recommend use of the <a href="http://mc-stan.org/bayesplot/" class="external-link"><code>bayesplot</code></a> package for sampling diagnostic plots.
For example, the function <code><a href="https://mc-stan.org/bayesplot/reference/MCMC-traces.html" class="external-link">bayesplot::mcmc_trace()</a></code> can be used to produce traceplots for specified parameters.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/bayesplot/" class="external-link">bayesplot</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-traces.html" class="external-link">mcmc_trace</a></span><span class="op">(</span><span class="va">fit</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Intercept"</span>, <span class="st">"Intercept_sigma"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="faq_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<p>We also provide a function <code><a href="../reference/epidist_diagnostics.html">epidist_diagnostics()</a></code> which can be used to obtain common diagnostics used to assess the quality of a fitted model.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/epidist_diagnostics.html">epidist_diagnostics</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 8</span></span></span>
<span><span class="co">##    time samples max_rhat divergent_transitions per_divergent_transitions</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>  3.93    <span style="text-decoration: underline;">2</span>000     1.00                     0                         0</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 3 more variables: max_treedepth &lt;dbl&gt;, no_at_max_treedepth &lt;int&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   per_at_max_treedepth &lt;dbl&gt;</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="id-like-to-run-a-simulation-study">I’d like to run a simulation study<a class="anchor" aria-label="anchor" href="#id-like-to-run-a-simulation-study"></a>
</h3>
<p>We recommend use of the <a href="https://purrr.tidyverse.org/" class="external-link"><code>purrr</code></a> package for running many <code>epidist</code> models, for example as a part of a simulation study.
We particularly highlight two functions which might be useful:</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map()</a></code> (and other similar functions) for iterating over a list of inputs.</li>
<li>
<code><a href="https://purrr.tidyverse.org/reference/safely.html" class="external-link">purrr::safely()</a></code> which ensures that the function called “always succeeds”. In other words, if there is an error it will be captured and output, rather than ending computation (and potentially disrupting a call to <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map()</a></code>).</li>
</ol>
<p>For an example use of these functions, have a look at the <a href="https://github.com/parksw3/epidist-paper" class="external-link"><code>epidist-paper</code></a> repository containing the code for <span class="citation">Park et al. (<a href="#ref-park2024estimating">2024</a>)</span>.
(Note that in that codebase, we use <code>map</code> as a part of a <a href="https://books.ropensci.org/targets/" class="external-link"><code>targets</code></a> pipeline.)</p>
</div>
<div class="section level3">
<h3 id="how-are-the-default-priors-for-epidist-chosen">How are the default priors for <code>epidist</code> chosen?<a class="anchor" aria-label="anchor" href="#how-are-the-default-priors-for-epidist-chosen"></a>
</h3>
<p><a href="http://paulbuerkner.com/brms/" class="external-link"><code>brms</code></a> provides default priors for all parameters.
However, some of those priors do not make sense in the context of our application.
Instead, we used <a href="https://mc-stan.org/docs/stan-users-guide/posterior-predictive-checks.html" class="external-link">prior predictive checking</a> to set <code>epidist</code>-specific default priors which produce epidemiological delay distribution mean and standard deviation parameters in a reasonable range.</p>
<p>For example, for the <code><a href="https://paulbuerkner.com/brms/reference/brmsfamily.html" class="external-link">brms::lognormal()</a></code> latent individual model, we suggest the following prior distributions for the <code>brms</code> <code>mu</code> and <code>sigma</code> intercept parameters:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Note that we export lognormal() as part of epidist hence no need for brms::</span></span>
<span><span class="va">family</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paulbuerkner.com/brms/reference/brmsfamily.html" class="external-link">lognormal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">epidist_family</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/epidist_family.html">epidist_family</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">family</span><span class="op">)</span></span>
<span><span class="va">epidist_formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/epidist_formula.html">epidist_formula</a></span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  family <span class="op">=</span> <span class="va">epidist_family</span>,</span>
<span>  formula <span class="op">=</span> <span class="va">mu</span> <span class="op">~</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># NULL here means no replacing priors from the user!</span></span>
<span><span class="va">epidist_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/epidist_prior.html">epidist_prior</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  family <span class="op">=</span> <span class="va">family</span>,</span>
<span>  formula <span class="op">=</span> <span class="va">epidist_formula</span>,</span>
<span>  prior <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">epidist_prior</span></span></code></pre></div>
<pre><code><span><span class="co">##                 prior     class coef group resp  dpar nlpar lb ub  source</span></span>
<span><span class="co">##  student_t(3, 5, 2.5) Intercept                                   default</span></span>
<span><span class="co">##  student_t(3, 0, 2.5) Intercept                 sigma             default</span></span></code></pre>
<p>(Note that the functions <code><a href="../reference/epidist_family.html">epidist_family()</a></code> and <code><a href="../reference/epidist_prior.html">epidist_prior()</a></code> are mostly for internal use!)</p>
<p>Here are the distributions on the delay distribution mean and standard deviation parameters that these prior distributions imply:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">fit_ppc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/epidist.html">epidist</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  formula <span class="op">=</span> <span class="va">mu</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://paulbuerkner.com/brms/reference/brmsfamily.html" class="external-link">lognormal</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  sample_prior <span class="op">=</span> <span class="st">"only"</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  backend <span class="op">=</span> <span class="st">"cmdstanr"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_delay_parameters.html">predict_delay_parameters</a></span><span class="op">(</span><span class="va">fit_ppc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pred</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mu"</span>, <span class="st">"sigma"</span>, <span class="st">"mean"</span>, <span class="st">"sd"</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"parameter"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"value"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">parameter</span> <span class="op"><a href="https://mc-stan.org/posterior/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"sd"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">parameter</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">comma</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span></code></pre>
<p><img src="faq_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">pred</span><span class="op">$</span><span class="va">mean</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.9</span>, <span class="fl">0.99</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         1%        10%        25%        50%        75%        90%        99% </span></span>
<span><span class="co">##  0.3172760  0.8667007  1.6163280  3.2461963  6.6291796 12.0852881 34.0415909</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">pred</span><span class="op">$</span><span class="va">sd</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.9</span>, <span class="fl">0.99</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         1%        10%        25%        50%        75%        90%        99% </span></span>
<span><span class="co">##  0.1335505  0.3950603  0.7687356  1.7107449  3.9206478  8.1671089 33.4421590</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="how-can-i-assess-how-sensitive-the-fitted-posterior-distribution-is-to-the-prior-distribution-used">How can I assess how sensitive the fitted posterior distribution is to the prior distribution used?<a class="anchor" aria-label="anchor" href="#how-can-i-assess-how-sensitive-the-fitted-posterior-distribution-is-to-the-prior-distribution-used"></a>
</h2>
<p>We recommend use of the <a href="https://github.com/n-kall/priorsense" class="external-link"><code>priorsense</code></a> package <span class="citation">(<a href="#ref-kallioinen2024detecting">Kallioinen et al. 2024</a>)</span> to check how sensitive the posterior distribution is to perturbations of the prior distribution and likelihood using power-scaling analysis:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://n-kall.github.io/priorsense/" class="external-link">priorsense</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://n-kall.github.io/priorsense/reference/powerscale_plots.html" class="external-link">powerscale_plot_dens</a></span><span class="op">(</span><span class="va">fit</span>, variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Intercept"</span>, <span class="st">"Intercept_sigma"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="what-do-the-parameters-in-my-model-output-correspond-to">What do the parameters in my model output correspond to?<a class="anchor" aria-label="anchor" href="#what-do-the-parameters-in-my-model-output-correspond-to"></a>
</h2>
<p>The <code>epidist</code> package uses <a href="http://paulbuerkner.com/brms/" class="external-link"><code>brms</code></a> to fit models.
This means that the model output will include <code>brms</code>-style names for parameters.
Here, we provide a table giving the correspondence between the distributional parameter names used in <code>brms</code> and those used in standard R functions for some common likelihood families.</p>
<table class="table">
<thead><tr class="header">
<th>Family</th>
<th>
<code>brms</code> parameter</th>
<th>R parameter</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code><a href="https://paulbuerkner.com/brms/reference/brmsfamily.html" class="external-link">lognormal()</a></code></td>
<td><code>mu</code></td>
<td><code>meanlog</code></td>
</tr>
<tr class="even">
<td><code><a href="https://paulbuerkner.com/brms/reference/brmsfamily.html" class="external-link">lognormal()</a></code></td>
<td><code>sigma</code></td>
<td><code>sdlog</code></td>
</tr>
<tr class="odd">
<td><code><a href="https://rdrr.io/r/stats/family.html" class="external-link">Gamma()</a></code></td>
<td><code>mu</code></td>
<td><code>shape / scale</code></td>
</tr>
<tr class="even">
<td><code><a href="https://rdrr.io/r/stats/family.html" class="external-link">Gamma()</a></code></td>
<td><code>shape</code></td>
<td><code>shape</code></td>
</tr>
</tbody>
</table>
<p>Note that all families in <code>brms</code> are parameterised with some measure of centrality <code>mu</code> as their first parameter.
This parameter does not necessarily correspond to the mean: hence the provision of a function <code><a href="../reference/add_mean_sd.html">add_mean_sd()</a></code> within <code>epidist</code> to add columns containing the natural scale mean and standard deviation to a <code>data.frame</code> of draws.</p>
</div>
<div class="section level2">
<h2 id="how-can-i-generate-predictions-with-my-fitted-epidist-model">How can I generate predictions with my fitted <code>epidist</code> model?<a class="anchor" aria-label="anchor" href="#how-can-i-generate-predictions-with-my-fitted-epidist-model"></a>
</h2>
<p>It is possible to generate predictions manually by working with <a href="https://epidist.epinowcast.org/articles/faq.html#i-would-like-to-work-with-the-samples-output">samples from the model output</a>.
However this is tricky to do, and so where possible we recommend using the <a href="http://mjskay.github.io/tidybayes/" class="external-link"><code>tidybayes</code></a> package.
In particular, following functions may be useful:</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="https://mjskay.github.io/tidybayes/reference/add_predicted_draws.html" class="external-link">tidybayes::add_epred_draws()</a></code> for predictions of the expected value of a delay.</li>
<li>
<code><a href="https://mjskay.github.io/tidybayes/reference/add_predicted_draws.html" class="external-link">tidybayes::add_linpred_draws()</a></code> for predictions of the delay distributional parameter linear predictors.</li>
<li>
<code><a href="https://mjskay.github.io/tidybayes/reference/add_predicted_draws.html" class="external-link">tidybayes::add_predicted_draws()</a></code> for predictions of the observed delay.</li>
</ol>
<p>To see these functions demonstrated in a vignette, see <a href="https://epidist.epinowcast.org/articles/ebola.html">“Advanced features with Ebola data”</a>.
As a short example, to generate 4000 predictions (equal to the number of draws) of the delay that would be observed with a double censored observation process (in which the primary and secondary censoring windows are both one) then:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">draws_pmf</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  relative_obs_time <span class="op">=</span> <span class="cn">Inf</span>, pwindow <span class="op">=</span> <span class="fl">1</span>, swindow <span class="op">=</span> <span class="fl">1</span>, delay_upr <span class="op">=</span> <span class="cn">NA</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://mjskay.github.io/tidybayes/reference/add_predicted_draws.html" class="external-link">add_predicted_draws</a></span><span class="op">(</span><span class="va">fit</span>, ndraws <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">draws_pmf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.prediction</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">count</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Delay"</span>, y <span class="op">=</span> <span class="st">"PMF"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="faq_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<p>Importantly, this functionality is only available for <code>epidist</code> models using <code>brms</code> families that have a <code>log_lik_censor</code> method implemented internally in <code>brms</code>. If you are using another family, consider <a href="https://github.com/epinowcast/epidist/pulls" class="external-link">submitting a pull request</a> to implement these methods!</p>
</div>
<div class="section level2">
<h2 id="how-can-i-use-the-cmdstanr-backend">How can I use the <code>cmdstanr</code> backend?<a class="anchor" aria-label="anchor" href="#how-can-i-use-the-cmdstanr-backend"></a>
</h2>
<p>The <code>cmdstanr</code> backend is typically more performant than the default <code>rstan</code> backend.
To use the <code>cmdstanr</code> backend, we first need to install CmdStan (see the README for more details). We can check we have everything we need as follows:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cmdstanr</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/cmdstanr/reference/set_cmdstan_path.html" class="external-link">cmdstan_version</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "2.36.0"</span></span></code></pre>
<div class="section level3">
<h3 id="bibliography">Bibliography<a class="anchor" aria-label="anchor" href="#bibliography"></a>
</h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-kallioinen2024detecting" class="csl-entry">
Kallioinen, Noa, Topi Paananen, Paul-Christian Bürkner, and Aki Vehtari. 2024. <span>“Detecting and Diagnosing Prior and Likelihood Sensitivity with Power-Scaling.”</span> <em>Statistics and Computing</em> 34 (1): 57.
</div>
<div id="ref-park2024estimating" class="csl-entry">
Park, Sang Woo, Andrei R. Akhmetzhanov, Kelly Charniga, Anne Cori, Nicholas G. Davies, Jonathan Dushoff, Sebastian Funk, et al. 2024. <span>“Estimating Epidemiological Delay Distributions for Infectious Diseases.”</span> <em>medRxiv</em>. <a href="https://doi.org/10.1101/2024.01.12.24301247" class="external-link">https://doi.org/10.1101/2024.01.12.24301247</a>.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://athowes.github.io/" class="external-link">Adam Howes</a>, Sang Woo Park, <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
